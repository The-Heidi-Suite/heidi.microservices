// Prisma schema for Permissions (stored in Core database)
generator client {
  provider = "prisma-client-js"
  output   = "../../../../node_modules/.prisma/client-permissions"
}

datasource db {
  provider = "postgresql"
  url      = env("CORE_DATABASE_URL")
}

// Permission model - Defines available permissions
model Permission {
  id          String   @id @default(uuid())
  resource    String   // e.g., "users", "cities", "notifications"
  action      String   // e.g., "read", "write", "delete"
  description String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  rolePermissions RolePermission[]

  @@unique([resource, action])
  @@index([resource])
  @@index([action])
  @@map("permissions")
}

// RolePermission - Maps roles to permissions
model RolePermission {
  id           String     @id @default(uuid())
  role         UserRole
  permissionId String
  createdAt    DateTime   @default(now())

  // Relations
  permission Permission @relation(fields: [permissionId], references: [id], onDelete: Cascade)

  @@unique([role, permissionId])
  @@index([role])
  @@index([permissionId])
  @@map("role_permissions")
}

// UserCityAssignment - Links users to cities with specific roles
// Note: userId and cityId are stored as strings (no FK due to multi-database architecture)
model UserCityAssignment {
  id        String   @id @default(uuid())
  userId    String   // Reference to User.id in users database
  cityId    String   // Reference to City.id in city database
  role      UserRole
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([userId, cityId])
  @@index([userId])
  @@index([cityId])
  @@index([role])
  @@map("user_city_assignments")
}

enum UserRole {
  SUPER_ADMIN
  CITY_ADMIN
  CITIZEN
}
