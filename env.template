# ============================================================================
# HEIDI Microservices - Environment Configuration
# ============================================================================
# Copy this file to .env: cp env.template .env
# Then update with your actual values
# ============================================================================

# ============================================================================
# Node Environment
# ============================================================================
NODE_ENV=development
SERVICE_VERSION=1.0.0

# ============================================================================
# PostgreSQL Server Configuration (Shared)
# ============================================================================
POSTGRES_HOST=localhost
POSTGRES_PORT=5432
POSTGRES_USER=heidi
POSTGRES_PASSWORD=heidi_password

# ============================================================================
# Per-Service Database Configuration
# ============================================================================

# Auth Service (Port 3001)
AUTH_PORT=3001
AUTH_DB_NAME=heidi_auth
AUTH_DATABASE_URL=postgresql://heidi:heidi_password@localhost:5432/heidi_auth

# Users Service (Port 3002)
USERS_PORT=3002
USERS_DB_NAME=heidi_users
USERS_DATABASE_URL=postgresql://heidi:heidi_password@localhost:5432/heidi_users

# City Service (Port 3003)
CITY_PORT=3003
CITY_DB_NAME=heidi_city
CITY_DATABASE_URL=postgresql://heidi:heidi_password@localhost:5432/heidi_city

# Core Service (Port 3004)
CORE_PORT=3004
CORE_DB_NAME=heidi_core
CORE_DATABASE_URL=postgresql://heidi:heidi_password@localhost:5432/heidi_core

# Notification Service (Port 3005)
NOTIFICATION_PORT=3005
NOTIFICATION_DB_NAME=heidi_notification
NOTIFICATION_DATABASE_URL=postgresql://heidi:heidi_password@localhost:5432/heidi_notification

# Scheduler Service (Port 3006)
SCHEDULER_PORT=3006
SCHEDULER_DB_NAME=heidi_scheduler
SCHEDULER_DATABASE_URL=postgresql://heidi:heidi_password@localhost:5432/heidi_scheduler

# Integration Service (Port 3007)
INTEGRATION_PORT=3007
INTEGRATION_DB_NAME=heidi_integration
INTEGRATION_DATABASE_URL=postgresql://heidi:heidi_password@localhost:5432/heidi_integration

# Admin Service (Port 3008)
ADMIN_PORT=3008
ADMIN_DB_NAME=heidi_admin
ADMIN_DATABASE_URL=postgresql://heidi:heidi_password@localhost:5432/heidi_admin

# Terminal Service (Port 3009)
TERMINAL_PORT=3009
TERMINAL_DB_NAME=heidi_terminal
TERMINAL_DATABASE_URL=postgresql://heidi:heidi_password@localhost:5432/heidi_terminal

# ============================================================================
# Redis Configuration (Shared Cache)
# ============================================================================
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=
REDIS_URL=redis://localhost:6379

# ============================================================================
# Hetzner Object Storage Configuration
# ============================================================================
# Endpoint URL for Hetzner Object Storage (location-bound, e.g., fsn1, nbg1)
# Format: https://{location}.your-objectstorage.com
HETZNER_STORAGE_ENDPOINT=https://fsn1.your-objectstorage.com

# Region/location code (e.g., fsn1 for Falkenstein, nbg1 for Nuremberg)
HETZNER_STORAGE_REGION=fsn1

# Access Key ID (from Hetzner Console -> Object Storage -> S3 Credentials)
HETZNER_STORAGE_ACCESS_KEY_ID=your_access_key_id

# Secret Access Key (save this immediately, cannot be viewed again)
HETZNER_STORAGE_SECRET_ACCESS_KEY=your_secret_access_key

# Default bucket name (optional, can be specified per operation)
HETZNER_STORAGE_DEFAULT_BUCKET=your-bucket-name

# ============================================================================
# RabbitMQ Configuration (Shared Message Queue)
# ============================================================================
RABBITMQ_HOST=localhost
RABBITMQ_PORT=5672
RABBITMQ_MANAGEMENT_PORT=15672
RABBITMQ_PROMETHEUS_PORT=15692
RABBITMQ_USER=heidi
RABBITMQ_PASSWORD=heidi_password
RABBITMQ_VHOST=/
RABBITMQ_URL=amqp://heidi:heidi_password@localhost:5672
RABBITMQ_QUEUE=heidi_queue

# ============================================================================
# JWT Configuration - ⚠️  CHANGE IN PRODUCTION!
# ============================================================================
JWT_SECRET=your-super-secret-jwt-key-change-this-in-production-min-32-chars
JWT_EXPIRES_IN=15m
JWT_REFRESH_SECRET=your-super-secret-refresh-key-change-this-in-production-min-32-chars
JWT_REFRESH_EXPIRES_IN=7d

# ============================================================================
# Logging Configuration
# ============================================================================
LOG_LEVEL=debug
LOG_DIR=./logs
ENABLE_FILE_LOGGING=false

# ============================================================================
# API Configuration
# ============================================================================
API_PREFIX=api
# Enable API gateway prefix for Swagger (set to 'true' for production/server)
# When enabled, Swagger will show /api/{service} paths; when disabled (local dev), no prefix
ENABLE_API_GATEWAY_PREFIX=false
# API Gateway Base URL (e.g., https://api.49.13.145.221.nip.io)
# If set, verification links and other service URLs will use this gateway URL
# Leave empty for local development (will use direct service URLs)
API_GATEWAY_BASE_URL=
CORS_ORIGIN=*
REQUEST_TIMEOUT_MS=30000

# ============================================================================
# Rate Limiting / Throttling
# ============================================================================
THROTTLE_TTL=60
THROTTLE_LIMIT=100

# ============================================================================
# Swagger/OpenAPI Documentation
# ============================================================================
SWAGGER_TITLE=HEIDI Microservices API
SWAGGER_DESCRIPTION=API documentation for HEIDI microservices
SWAGGER_VERSION=1.0

# ============================================================================
# Internationalization (i18n) Configuration
# ============================================================================
# Default language code (ISO 639-1) used when Accept-Language header is missing
I18N_DEFAULT_LANGUAGE=en

# Supported languages (comma-separated ISO 639-1 codes)
# Languages: de (German), en (English), dk (Danish), no (Norwegian), se (Swedish),
#            ar (Arabic), fa (Persian/Farsi), tr (Turkish), ru (Russian), uk (Ukrainian)
I18N_SUPPORTED_LANGUAGES=de,en,dk,no,se,ar,fa,tr,ru,uk

# ============================================================================
# Translations / DeepL Configuration
# ============================================================================
# Default source language for content translations (usually matches I18N_DEFAULT_LANGUAGE)
TRANSLATIONS_DEFAULT_SOURCE_LOCALE=en

# Enable automatic translation on read when a translation is missing
# Set to 'false' to disable on-read auto-translation
TRANSLATIONS_AUTO_TRANSLATE_ON_READ=true

# DeepL API key (required for automatic translations)
# Sign up at https://www.deepl.com/ for an API key
DEEPL_API_KEY=your_deepl_api_key_here

# DeepL API URL
# For free accounts:  https://api-free.deepl.com/v2/translate
# For paid accounts:  https://api.deepl.com/v2/translate
DEEPL_API_URL=https://api-free.deepl.com/v2/translate

# DeepL retry configuration for rate limit handling
# Maximum number of retries when hitting rate limits (default: 3)
DEEPL_MAX_RETRIES=3
# Base delay in milliseconds for exponential backoff (default: 1000)
DEEPL_RETRY_DELAY_MS=1000

# Translation concurrency control
# Maximum number of concurrent translation requests (default: 3)
TRANSLATION_MAX_CONCURRENT=3
# Maximum number of requeue attempts for failed translations (default: 3)
TRANSLATION_MAX_REQUEUE_ATTEMPTS=3

# ============================================================================
# Terms of Use Configuration
# ============================================================================
# Default locale for terms of use (e.g., 'en', 'de', 'ar')
TERMS_DEFAULT_LOCALE=en

# Grace period in days for users to accept updated terms (default: 7)
TERMS_GRACE_PERIOD_DAYS=7

# ============================================================================
# Email/SMTP Configuration
# ============================================================================
# Required: Email address used as the "from" address
SYSTEM_EMAIL_ID=noreply@heidi.example.com

# Required: SMTP server hostname
SMTP_HOST=smtp.gmail.com

# Required: SMTP authentication credentials
SMTP_USER=your-email@gmail.com
SMTP_PASSWORD=your-app-specific-password

# Optional: SMTP server port (leave empty for default port based on secure setting)
# Common ports: 25 (non-encrypted), 587 (TLS), 465 (SSL)
SMTP_PORT=587

# Optional: Use secure connection (SSL/TLS)
# Set to 'true' for port 465 (SSL), 'false' for port 587 (TLS) or 25 (plain)
# If not set, nodemailer will auto-detect based on port
SMTP_SECURE=false

# Optional: Custom path for SMTP server (e.g., "/webmail-rc" for some custom servers)
# Leave empty if not needed
SMTP_PATH=/webmail-rc

# Optional: TLS certificate validation
# Set to 'false' to allow self-signed certificates (useful for custom SMTP servers)
# Set to 'true' or leave empty for strict certificate validation (recommended for production)
SMTP_TLS_REJECT_UNAUTHORIZED=false

# ============================================================================
# Client/Frontend URL
# ============================================================================
CLIENT_URL=http://localhost:4200

# ============================================================================
# Monitoring & Alerting
# ============================================================================
SERVICE_NAME=heidi-service
METRICS_ENABLED=true

# Alert Webhook (optional)
ALERT_WEBHOOK_URL=

# Alert Email (optional)
ALERT_SMTP_HOST=smtp.gmail.com
ALERT_SMTP_PORT=587
ALERT_SMTP_USER=alerts@example.com
ALERT_SMTP_PASS=
ALERT_FROM_EMAIL=alerts@example.com
ALERT_TO_EMAILS=admin@example.com

# Slack Webhook (optional)
ALERT_SLACK_WEBHOOK_URL=

# ============================================================================
# Development/Debug Configuration (uncomment for debugging)
# ============================================================================
# DEBUG=*
# PRISMA_LOG_LEVEL=query,info,warn,error

# ============================================================================
# Docker Compose
# ============================================================================
COMPOSE_PROJECT_NAME=heidi

# ============================================================================
# Monitoring & Observability
# ============================================================================
# Prometheus
PROMETHEUS_PORT=9090

# Alertmanager
ALERTMANAGER_PORT=9093

# Grafana
GRAFANA_PORT=3000
GRAFANA_ADMIN_USER=admin
GRAFANA_ADMIN_PASSWORD=admin
GRAFANA_ALLOW_SIGN_UP=false
GRAFANA_ROOT_URL=http://localhost:3000

# Metrics Exporters
NODE_EXPORTER_PORT=9100
POSTGRES_EXPORTER_PORT=9187
REDIS_EXPORTER_PORT=9121

# ============================================================================
# Administration Tools
# ============================================================================
# pgAdmin
PGADMIN_PORT=5050
PGADMIN_EMAIL=admin@heidi.local
PGADMIN_PASSWORD=admin

# Redis Commander
REDIS_COMMANDER_PORT=8081
REDIS_COMMANDER_USER=admin
REDIS_COMMANDER_PASSWORD=admin

# ============================================================================
# Reverse Proxy (Nginx)
# ============================================================================
NGINX_HTTP_PORT=80
NGINX_HTTPS_PORT=443

# ============================================================================
# Reverse Proxy (Caddy) - Development with Auto SSL
# ============================================================================
# Development IP for nip.io domain (e.g., 192.168.1.100)
# Used to generate domain like: api.192.168.1.100.nip.io
DEV_IP=localhost

# Let's Encrypt email for SSL certificates
LETSENCRYPT_EMAIL=admin@heidi.com

# Use Let's Encrypt staging environment (set to 'true' for testing to avoid rate limits)
LETSENCRYPT_STAGING=false

# Caddy HTTP/HTTPS ports
CADDY_HTTP_PORT=80
CADDY_HTTPS_PORT=443

# React frontend build folder path (absolute or relative to docker-compose.yml)
# This is the path to your React app's build directory on the host machine
# Example: /home/user/projects/heidi-frontend/build
# Or relative: ../heidi-frontend/build
# Leave empty or unset if not serving a frontend
REACT_BUILD_PATH=../heidi-frontend/build

# ============================================================================
# Integration Seeding - Destination One
# ============================================================================
# Destination One API credentials/config
DO_LICENSEKEY=
DO_EXPERIENCE=heidi-app-kiel
DO_TEMPLATE=ET2014A_MULTI.json
DO_TYPES=Gastro
DO_BASE_URL=https://meta.et4.de/rest.ashx/search/
INTEGRATION_NAME=Destination One - Kiel
INTEGRATION_ACTIVE=true

# ============================================================================
# Integration Seeding - Mobilithek Parking
# ============================================================================
# Mobilithek/KielRegion API URL (default: https://apis.kielregion.addix.io/mtparken/)
# Note: Set this before running seed-mobilithek-parking-integration.ts
# The actual parking data is served by KielRegion API, not the Mobilithek catalog endpoint
MOBILITHEK_API_URL=https://apis.kielregion.addix.io/mtparken/
# Mobilithek API key (optional, only if API requires authentication)
MOBILITHEK_API_KEY=
# Integration display name (default: "Mobilithek Parking - Kiel")
# Note: This variable name is shared with Destination One - set it before running each seed script
INTEGRATION_NAME=Mobilithek Parking - Kiel
# Update interval in minutes (default: 1, matches API update frequency)
UPDATE_INTERVAL=1
# Note: INTEGRATION_ACTIVE from above also applies to Mobilithek integration

# ============================================================================
# Integration Seeding - Kiel Newsletter (E-Marketing Suite)
# ============================================================================
# E-Marketing Suite API configuration
# Client ID (default: KIEL)
KIEL_NEWSLETTER_CLIENT_ID=KIEL
# Host URL for EMS API (default: https://wlk-ems.com/crm/api/v1/KIEL/)
KIEL_NEWSLETTER_HOST_URL=https://wlk-ems.com/crm/api/v1/KIEL/
# API Key for EMS authentication (REQUIRED - replace with your actual API key)
KIEL_NEWSLETTER_API_KEY=your_ems_api_key_here
# Attribute ID for newsletter signup (default: 3022526340)
KIEL_NEWSLETTER_ATTRIBUTE_ID=3022526340
# Event ID for signup event (default: 3022526329)
KIEL_NEWSLETTER_EVENT_ID=3022526329
# Consent purpose ID for newsletter subscription (default: 1005)
KIEL_NEWSLETTER_CONSENT_PURPOSE_ID=1005
# Integration display name (default: "Kiel Newsletter")
INTEGRATION_NAME_KIEL_NEWSLETTER=Kiel Newsletter
# Note: INTEGRATION_ACTIVE from above also applies to Kiel Newsletter integration
